<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Live Code Typing</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      background: #0d1117;
      color: #c9d1d9;
      font-family: 'Consolas', 'Monaco', 'JetBrains Mono', monospace;
      font-size: 14px;
      line-height: 1.6;
      min-height: 100vh;
      overflow: hidden;
    }
    .header {
      background: #161b22;
      padding: 8px 16px;
      border-bottom: 1px solid #30363d;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
    }
    .dot.red { background: #ff5f56; }
    .dot.yellow { background: #ffbd2e; }
    .dot.green { background: #27c93f; }
    .title {
      margin-left: 12px;
      color: #8b949e;
      font-size: 12px;
    }
    .code-area {
      padding: 16px 20px 40px;
      height: calc(100vh - 45px);
      overflow-y: auto;
      overflow-x: hidden;
    }
    .line {
      white-space: pre;
      min-height: 1.6em;
    }
    .line .cursor {
      display: inline-block;
      width: 8px;
      height: 1.2em;
      background: #58a6ff;
      animation: blink 0.8s step-end infinite;
      vertical-align: text-bottom;
    }
    @keyframes blink {
      50% { opacity: 0; }
    }
    .keyword { color: #ff7b72; }
    .string { color: #a5d6ff; }
    .function { color: #d2a8ff; }
    .comment { color: #8b949e; }
    .number { color: #79c0ff; }

    .side-panel {
      position: fixed;
      top: 56px;
      right: 16px;
      width: 360px;
      max-height: 60vh;
      background: #050814;
      border: 1px solid #30363d;
      border-radius: 10px;
      box-shadow: 0 18px 45px rgba(0, 0, 0, 0.7);
      overflow: hidden;
      display: flex;
      flex-direction: column;
      opacity: 0;
      transform: translateY(8px);
      pointer-events: none;
      transition: opacity 0.25s ease, transform 0.25s ease;
      font-size: 12px;
    }
    .side-panel.visible {
      opacity: 1;
      transform: translateY(0);
      pointer-events: auto;
    }
    .side-panel-header {
      padding: 6px 10px;
      background: linear-gradient(90deg, #111827, #020617);
      border-bottom: 1px solid #1f2933;
      display: flex;
      justify-content: space-between;
      align-items: center;
      color: #9ca3af;
    }
    .side-panel-header span.label {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: #6b7280;
    }
    .side-panel-header span.env {
      font-size: 11px;
      padding: 2px 6px;
      border-radius: 999px;
      background: rgba(34, 197, 94, 0.12);
      color: #4ade80;
      border: 1px solid rgba(34, 197, 94, 0.3);
    }
    .side-panel-body {
      padding: 8px 10px 10px;
      background: radial-gradient(circle at top left, rgba(56, 189, 248, 0.15), transparent 60%),
                  radial-gradient(circle at bottom right, rgba(59, 130, 246, 0.12), transparent 60%),
                  #020617;
      font-family: "JetBrains Mono", "Consolas", monospace;
      overflow-y: auto;
    }
    .prompt-line {
      white-space: pre;
    }
    .prompt-prefix {
      color: #22c55e;
    }
    .prompt-command {
      color: #e5e7eb;
    }
    .prompt-meta {
      color: #6b7280;
    }

    .toast-container {
      position: fixed;
      right: 16px;
      bottom: 16px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      z-index: 30;
    }
    .toast {
      min-width: 260px;
      max-width: 320px;
      background: #111827;
      border-radius: 8px;
      padding: 8px 10px;
      border-left: 3px solid #fbbf24;
      box-shadow: 0 14px 35px rgba(0, 0, 0, 0.65);
      color: #e5e7eb;
      font-size: 12px;
      display: flex;
      flex-direction: column;
      gap: 2px;
      opacity: 0;
      transform: translateX(16px) translateY(6px);
      animation: toast-in 0.23s ease-out forwards, toast-out 0.25s ease-in forwards;
      animation-delay: 0s, 3s;
    }
    .toast-title {
      font-weight: 600;
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: #fbbf24;
    }
    .toast-message {
      font-size: 12px;
    }
    .toast-meta {
      font-size: 10px;
      color: #9ca3af;
    }
    @keyframes toast-in {
      from { opacity: 0; transform: translateX(18px) translateY(8px); }
      to { opacity: 1; transform: translateX(0) translateY(0); }
    }
    @keyframes toast-out {
      from { opacity: 1; transform: translateX(0) translateY(0); }
      to { opacity: 0; transform: translateX(10px) translateY(4px); }
    }
  </style>
</head>
<body>
  <div class="header">
    <span class="dot red"></span>
    <span class="dot yellow"></span>
    <span class="dot green"></span>
    <span class="title">index.js — Live</span>
  </div>
  <div class="code-area" id="codeArea">
    <div class="line" id="lines"></div>
  </div>

  <div class="side-panel" id="promptPanel">
    <div class="side-panel-header">
      <span class="label">command palette</span>
      <span class="env">prod · eu-west-1</span>
    </div>
    <div class="side-panel-body" id="promptBody"></div>
  </div>

  <div class="toast-container" id="toastContainer"></div>

  <script>
    const codeArea = document.getElementById('codeArea');
    const linesEl = document.getElementById('lines');

    const snippets = [
      { text: 'function ', type: 'keyword' },
      { text: 'fetchData', type: 'function' },
      { text: '(url) {\n  ', type: 'plain' },
      { text: 'return ', type: 'keyword' },
      { text: 'fetch', type: 'function' },
      { text: '(url)\n    .then', type: 'plain' },
      { text: '(res => res.json())\n    .then', type: 'plain' },
      { text: '(data => {\n      ', type: 'plain' },
      { text: 'console', type: 'function' },
      { text: '.log', type: 'function' },
      { text: '(', type: 'plain' },
      { text: '"Loaded:"', type: 'string' },
      { text: ', data);\n    });\n}\n\n', type: 'plain' },
      { text: '// ', type: 'comment' },
      { text: 'API 호출 예시\n', type: 'comment' },
      { text: 'const ', type: 'keyword' },
      { text: 'apiUrl', type: 'plain' },
      { text: ' = ', type: 'plain' },
      { text: '"https://api.example.com/data"', type: 'string' },
      { text: ';\n', type: 'plain' },
      { text: 'fetchData', type: 'function' },
      { text: '(apiUrl);\n\n', type: 'plain' },
      { text: 'class ', type: 'keyword' },
      { text: 'UserService', type: 'function' },
      { text: ' {\n  ', type: 'plain' },
      { text: 'constructor', type: 'function' },
      { text: '(name) {\n    ', type: 'plain' },
      { text: 'this', type: 'keyword' },
      { text: '.name = name;\n  }\n\n  ', type: 'plain' },
      { text: 'async ', type: 'keyword' },
      { text: 'getProfile', type: 'function' },
      { text: '() {\n    ', type: 'plain' },
      { text: 'const ', type: 'keyword' },
      { text: 'res', type: 'plain' },
      { text: ' = ', type: 'plain' },
      { text: 'await ', type: 'keyword' },
      { text: 'fetch', type: 'function' },
      { text: '(`/api/users/', type: 'plain' },
      { text: '${this.name}', type: 'string' },
      { text: '`);\n    ', type: 'plain' },
      { text: 'return ', type: 'keyword' },
      { text: 'res.json', type: 'function' },
      { text: '();\n  }\n}\n\n', type: 'plain' },
      { text: '// ', type: 'comment' },
      { text: '타이머와 이벤트\n', type: 'comment' },
      { text: 'setInterval', type: 'function' },
      { text: '(() => {\n  ', type: 'plain' },
      { text: 'const ', type: 'keyword' },
      { text: 'now', type: 'plain' },
      { text: ' = ', type: 'plain' },
      { text: 'new Date', type: 'function' },
      { text: '();\n  ', type: 'plain' },
      { text: 'console', type: 'function' },
      { text: '.log', type: 'function' },
      { text: '(now.toISOString());\n}, ', type: 'plain' },
      { text: '1000', type: 'number' },
      { text: ');\n\n', type: 'plain' },

      // 추가: 간단한 React 컴포넌트
      { text: '// ', type: 'comment' },
      { text: 'React 컴포넌트 예시\n', type: 'comment' },
      { text: 'function ', type: 'keyword' },
      { text: 'App', type: 'function' },
      { text: '() {\n  ', type: 'plain' },
      { text: 'const ', type: 'keyword' },
      { text: '[count, setCount]', type: 'plain' },
      { text: ' = ', type: 'plain' },
      { text: 'React.useState', type: 'function' },
      { text: '(', type: 'plain' },
      { text: '0', type: 'number' },
      { text: ');\n\n  ', type: 'plain' },
      { text: 'return ', type: 'keyword' },
      { text: '(\n    ', type: 'plain' },
      { text: '<button onClick={() => setCount(c => c + ', type: 'plain' },
      { text: '1', type: 'number' },
      { text: ')}>', type: 'plain' },
      { text: '"Clicked "', type: 'string' },
      { text: ' + count + ', type: 'plain' },
      { text: '" times"', type: 'string' },
      { text: '</button>\n  );\n}\n\n', type: 'plain' },

      // 추가: 유틸 함수 모음
      { text: 'const ', type: 'keyword' },
      { text: 'delay', type: 'plain' },
      { text: ' = ', type: 'plain' },
      { text: '(ms) => ', type: 'plain' },
      { text: 'new Promise', type: 'function' },
      { text: '(resolve => setTimeout(resolve, ms));\n', type: 'plain' },
      { text: 'const ', type: 'keyword' },
      { text: 'range', type: 'plain' },
      { text: ' = ', type: 'plain' },
      { text: '(n) => ', type: 'plain' },
      { text: 'Array', type: 'function' },
      { text: '.from', type: 'function' },
      { text: '({ length: n }, (_, i) => i);\n\n', type: 'plain' },

      // 추가: 간단한 상태 머신
      { text: 'const ', type: 'keyword' },
      { text: 'MachineState', type: 'plain' },
      { text: ' = ', type: 'plain' },
      { text: '{ IDLE: ', type: 'plain' },
      { text: '"IDLE"', type: 'string' },
      { text: ', LOADING: ', type: 'plain' },
      { text: '"LOADING"', type: 'string' },
      { text: ', DONE: ', type: 'plain' },
      { text: '"DONE"', type: 'string' },
      { text: ' };\n', type: 'plain' },
      { text: 'let ', type: 'keyword' },
      { text: 'state', type: 'plain' },
      { text: ' = ', type: 'plain' },
      { text: 'MachineState.IDLE;\n', type: 'plain' },
      { text: 'function ', type: 'keyword' },
      { text: 'transition', type: 'function' },
      { text: '(event) {\n  ', type: 'plain' },
      { text: 'switch ', type: 'keyword' },
      { text: '(state) {\n    ', type: 'plain' },
      { text: 'case ', type: 'keyword' },
      { text: 'MachineState.IDLE', type: 'plain' },
      { text: ':\n      ', type: 'plain' },
      { text: 'if ', type: 'keyword' },
      { text: '(event === ', type: 'plain' },
      { text: '"FETCH"', type: 'string' },
      { text: ') state = MachineState.LOADING;\n      ', type: 'plain' },
      { text: 'break', type: 'keyword' },
      { text: ';\n    ', type: 'plain' },
      { text: 'case ', type: 'keyword' },
      { text: 'MachineState.LOADING', type: 'plain' },
      { text: ':\n      ', type: 'plain' },
      { text: 'if ', type: 'keyword' },
      { text: '(event === ', type: 'plain' },
      { text: '"DONE"', type: 'string' },
      { text: ') state = MachineState.DONE;\n      ', type: 'plain' },
      { text: 'break', type: 'keyword' },
      { text: ';\n  }\n}\n\n', type: 'plain' },

      // 추가: 한국어 주석이 많은 설정 객체
      { text: 'const ', type: 'keyword' },
      { text: 'config', type: 'plain' },
      { text: ' = {\n  ', type: 'plain' },
      { text: '// ', type: 'comment' },
      { text: '서비스 기본 설정\n', type: 'comment' },
      { text: 'env', type: 'plain' },
      { text: ': ', type: 'plain' },
      { text: '"production"', type: 'string' },
      { text: ',\n  ', type: 'plain' },
      { text: 'retry', type: 'plain' },
      { text: ': ', type: 'plain' },
      { text: '3', type: 'number' },
      { text: ',\n  ', type: 'plain' },
      { text: 'timeout', type: 'plain' },
      { text: ': ', type: 'plain' },
      { text: '5000', type: 'number' },
      { text: ',\n  ', type: 'plain' },
      { text: 'features', type: 'plain' },
      { text: ': { ', type: 'plain' },
      { text: 'logging', type: 'plain' },
      { text: ': ', type: 'plain' },
      { text: 'true', type: 'keyword' },
      { text: ', ', type: 'plain' },
      { text: 'metrics', type: 'plain' },
      { text: ': ', type: 'plain' },
      { text: 'true', type: 'keyword' },
      { text: ' }\n};\n\n', type: 'plain' },
    ];

    let snippetIndex = 0;
    let charIndex = 0;
    let currentSnippet = snippets[0].text;
    let currentType = snippets[0].type;
    let html = '';

    function span(cls, char) {
      return '<span class="' + cls + '">' + (char === '\n' ? '<br>' : char.replace(/</g, '&lt;').replace(/>/g, '&gt;')) + '</span>';
    }

    function typeNext() {
      if (charIndex >= currentSnippet.length) {
        snippetIndex = (snippetIndex + 1) % snippets.length;
        currentSnippet = snippets[snippetIndex].text;
        currentType = snippets[snippetIndex].type;
        charIndex = 0;
      }
      const char = currentSnippet[charIndex++];
      const cls = currentType === 'plain' ? '' : currentType;
      html += cls ? span(cls, char) : (char === '\n' ? '<br>' : char.replace(/</g, '&lt;').replace(/>/g, '&gt;'));
      linesEl.innerHTML = html + '<span class="cursor"></span>';
      codeArea.scrollTop = codeArea.scrollHeight;
    }

    setInterval(typeNext, 40);

    // ---------- 우측 프롬프트 & 알림 ----------
    const promptPanel = document.getElementById('promptPanel');
    const promptBody = document.getElementById('promptBody');
    const toastContainer = document.getElementById('toastContainer');

    const sleep = (ms) => new Promise(resolve => setTimeout(resolve, ms));

    const promptScripts = [
      {
        lines: [
          '$ git status',
          'On branch main',
          'Your branch is ahead of \'origin/main\' by 2 commits.',
          '  (use "git push" to publish your local commits)',
        ],
      },
      {
        lines: [
          '$ kubectl get pods -n prod',
          'NAME                           READY   STATUS    RESTARTS   AGE',
          'api-gateway-7c9f786c8b-nmx9k   2/2     Running   0          3d12h',
          'worker-processor-5b6c7b9cf9    1/1     Running   2          7d',
        ],
      },
      {
        lines: [
          '$ yarn deploy:web',
          'info  Building production bundle...',
          'info  Running smoke tests...',
          '✅  Deployment finished in 38.4s',
        ],
      },
      {
        lines: [
          '$ tail -f logs/payments.log',
          '[INFO]  request_id=... 开始支付流程',
          '[INFO]  gateway=stripe latency=142ms',
          '[WARN]  retrying charge, attempt=2',
        ],
      },
    ];

    async function playPromptLoop() {
      let index = 0;
      while (true) {
        const script = promptScripts[index % promptScripts.length];
        index++;

        promptBody.innerHTML = '';
        promptPanel.classList.add('visible');

        for (const raw of script.lines) {
          const lineEl = document.createElement('div');
          lineEl.className = 'prompt-line';

          const prefixSpan = document.createElement('span');
          prefixSpan.className = 'prompt-prefix';
          if (raw.startsWith('$')) {
            prefixSpan.textContent = '$ ';
          } else {
            prefixSpan.textContent = '› ';
          }

          const cmdSpan = document.createElement('span');
          cmdSpan.className = 'prompt-command';
          const text = raw.startsWith('$') ? raw.slice(1).trimStart() : raw;
          cmdSpan.textContent = '';

          lineEl.appendChild(prefixSpan);
          lineEl.appendChild(cmdSpan);
          promptBody.appendChild(lineEl);

          for (let i = 0; i < text.length; i++) {
            cmdSpan.textContent += text[i];
            await sleep(18);
          }
          await sleep(260);
        }

        await sleep(1400);
        promptPanel.classList.remove('visible');
        await sleep(2000 + Math.random() * 2000);
      }
    }

    const warningMessages = [
      {
        title: 'build warning',
        message: 'Bundle size exceeded recommended limit (1.9 MB > 1.5 MB).',
        meta: 'web-client · main · #deploy-1342',
      },
      {
        title: 'latency spike',
        message: 'p95 latency for /api/payments increased to 820ms in the last 5m.',
        meta: 'observability · eu-west-1',
      },
      {
        title: 'autoscaler event',
        message: 'Scaled worker pool from 6 → 12 instances due to backlog.',
        meta: 'worker-queue · k8s/hpa',
      },
      {
        title: 'slow query',
        message: 'SELECT * FROM orders WHERE status = \'PENDING\' took 2.4s.',
        meta: 'postgres · read-replica-2',
      },
    ];

    function showToast() {
      const def = warningMessages[Math.floor(Math.random() * warningMessages.length)];
      const toast = document.createElement('div');
      toast.className = 'toast';

      const title = document.createElement('div');
      title.className = 'toast-title';
      title.textContent = def.title;

      const msg = document.createElement('div');
      msg.className = 'toast-message';
      msg.textContent = def.message;

      const meta = document.createElement('div');
      meta.className = 'toast-meta';
      meta.textContent = def.meta;

      toast.appendChild(title);
      toast.appendChild(msg);
      toast.appendChild(meta);
      toastContainer.appendChild(toast);

      setTimeout(() => {
        toast.remove();
      }, 3600);
    }

    async function toastLoop() {
      while (true) {
        await sleep(2500 + Math.random() * 4500);
        showToast();
      }
    }

    playPromptLoop();
    toastLoop();
  </script>
</body>
</html>
